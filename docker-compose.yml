services:
  # 1. SCANNER SERVICE (Uses the main Dockerfile in the root)
  scanner:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: ml_scanner
    restart: always
    environment:
      # CRITICAL: Local setting uses the internal Docker network name 'telegram_proxy'
      TELEGRAM_PROXY_URL: "http://telegram_proxy:8001/send_alert" 
      #TELEGRAM_PROXY_URL: "https://model-breakup1-1.onrender.com/send_alert" # Use this for remote deployment without proxy service in render, but we should comment the local proxy service in this case 
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN} 
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
    volumes:
      # Map current directory to container (useful for code changes)
      - .:/app
    ports:
      - "7860:7860"

  # 2. PROXY SERVICE (Uses its specific Dockerfile)
  telegram_proxy:
    build:
      context: .
      dockerfile: ./proxy_service/Dockerfile.proxy
    container_name: telegram_proxy_server
    restart: always
    environment:
      # Proxy needs the real credentials to send to Telegram
      TELEGRAM_BOT_TOKEN: ${TELEGRAM_BOT_TOKEN}
      TELEGRAM_CHAT_ID: ${TELEGRAM_CHAT_ID}
    volumes:
      # Map proxy service code
      - ./proxy_service:/app
    ports:
      - "8001:8001"